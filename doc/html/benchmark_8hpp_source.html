<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>n-Dimensional Fast Marching: /home/acerillo/fastmarching/benchmark/benchmark.hpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">n-Dimensional Fast Marching
   &#160;<span id="projectnumber">0.6</span>
   </div>
   
  </td>
  
  
  
   
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('benchmark_8hpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">/home/acerillo/fastmarching/benchmark/benchmark.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00020"></a>00020 <span class="preprocessor">#ifndef BENCHMARK_HPP_</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#define BENCHMARK_HPP_</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;chrono&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;boost/filesystem.hpp&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;boost/progress.hpp&gt;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;../fmm/solver.hpp&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;../io/gridwriter.hpp&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="keyword">template</span> &lt;<span class="keyword">class</span> gr<span class="keywordtype">id</span>_t&gt;
<a name="l00033"></a><a class="code" href="classBenchmark.html">00033</a> <span class="keyword">class </span><a class="code" href="classBenchmark.html" title="This class provides the utilities to benchmark Fast Marching Solvers (configuration, running and logging). It works for FMM (any heap and SFMM), FIM and UFMM. It has not been tested with FM2 solvers.">Benchmark</a> {
<a name="l00034"></a>00034 
<a name="l00035"></a>00035     <span class="keyword">public</span>:
<a name="l00036"></a>00036 
<a name="l00037"></a>00037         <a class="code" href="classBenchmark.html" title="This class provides the utilities to benchmark Fast Marching Solvers (configuration, running and logging). It works for FMM (any heap and SFMM), FIM and UFMM. It has not been tested with FM2 solvers.">Benchmark</a>
<a name="l00038"></a>00038         (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classBenchmark.html#ab30b8f9f624ab3256ffd7368e7789602" title="Saves the grid values result of the last run of solver s.">saveGrid</a> = 0, <span class="keywordtype">bool</span> <a class="code" href="classBenchmark.html#a9abd5007cab840911646b3d684e7f9ae" title="Saves the log to a file: benchmark_name.log.">saveLog</a> = <span class="keyword">true</span>) :
<a name="l00039"></a>00039         <a class="code" href="classBenchmark.html#a4422043c8708bf0b1f64bbd16f8c573f" title="If 1, the resulting grids (times) of the first run of each solver are saved to files. If 2, the grids for all runs of each solver are saved.">saveGrid_</a>(<a class="code" href="classBenchmark.html#ab30b8f9f624ab3256ffd7368e7789602" title="Saves the grid values result of the last run of solver s.">saveGrid</a>),
<a name="l00040"></a>00040         <a class="code" href="classBenchmark.html#a6cf2de133683c9d1dc066071c112770e" title="If true, the log is saved to file. Output on terminal otherwise.">saveLog_</a>(<a class="code" href="classBenchmark.html#a9abd5007cab840911646b3d684e7f9ae" title="Saves the log to a file: benchmark_name.log.">saveLog</a>),
<a name="l00041"></a>00041         <a class="code" href="classBenchmark.html#ab1bd24b875944be6239482093f72e57e" title="ID of the current run.">runID_</a>(0),
<a name="l00042"></a>00042         <a class="code" href="classBenchmark.html#a3c1e9fce757032a3d9447d26548a5e64" title="Number of runs for each solver.">nruns_</a>(10),
<a name="l00043"></a>00043         <a class="code" href="classBenchmark.html#a059a82a3a32a3d71ac88bc7652f98675" title="Path were the results will be saved.">path_</a>(<span class="stringliteral">&quot;results&quot;</span>),
<a name="l00044"></a>00044         <a class="code" href="classBenchmark.html#aeea93203bda688bab6cb5d0df2c371e3" title="Benchmark name.">name_</a>(<span class="stringliteral">&quot;benchmark&quot;</span>),
<a name="l00045"></a>00045         <a class="code" href="classBenchmark.html#a4f0af32d7e8e95e760b5de4f26854d65" title="If true, benchmark configured from CFG file, used to selectively free memory.">fromCFG_</a>(<span class="keyword">false</span>){}
<a name="l00046"></a>00046 
<a name="l00047"></a>00047         <span class="keyword">virtual</span> ~<a class="code" href="classBenchmark.html" title="This class provides the utilities to benchmark Fast Marching Solvers (configuration, running and logging). It works for FMM (any heap and SFMM), FIM and UFMM. It has not been tested with FM2 solvers.">Benchmark</a>()
<a name="l00048"></a>00048         {
<a name="l00049"></a>00049             <a class="code" href="classBenchmark.html#a1e3415434c820dee4fde0b0fee1b7ec3" title="Clears and free memory allocated by the benchmark.">clear</a>();
<a name="l00050"></a>00050         }
<a name="l00051"></a>00051 
<a name="l00053"></a>00053         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a7017a4d963bd8845127ce0e92fc39333" title="Set true if the benchmark is configured from a cfg file.">fromCFG</a>
<a name="l00054"></a><a class="code" href="classBenchmark.html#a7017a4d963bd8845127ce0e92fc39333">00054</a>         (<span class="keywordtype">bool</span> cfg) {
<a name="l00055"></a>00055             <a class="code" href="classBenchmark.html#a4f0af32d7e8e95e760b5de4f26854d65" title="If true, benchmark configured from CFG file, used to selectively free memory.">fromCFG_</a> = cfg;
<a name="l00056"></a>00056         }
<a name="l00057"></a>00057 
<a name="l00059"></a>00059         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a89d766e24f43666e24dc68fd691a32e3" title="Adds a new solver to be benchmarked.">addSolver</a>
<a name="l00060"></a><a class="code" href="classBenchmark.html#a89d766e24f43666e24dc68fd691a32e3">00060</a>         (<a class="code" href="classSolver.html" title="Abstract class that serves as interface for the actual solvers implemented. It requires (at least) th...">Solver&lt;grid_t&gt;</a>* solver) {
<a name="l00061"></a>00061             <a class="code" href="classBenchmark.html#a5f28000d7d9e8fc852c0187a93fbaa67" title="Stores the solvers to be run in the benchmark.">solvers_</a>.push_back(solver);
<a name="l00062"></a>00062         }
<a name="l00063"></a>00063 
<a name="l00065"></a>00065         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a9f1fba3c435eaafe2a85f71e14819c4b" title="Sets the saveGrid_ flag.">setSaveGrid</a>
<a name="l00066"></a><a class="code" href="classBenchmark.html#a9f1fba3c435eaafe2a85f71e14819c4b">00066</a>         (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> s) {
<a name="l00067"></a>00067             <a class="code" href="classBenchmark.html#a4422043c8708bf0b1f64bbd16f8c573f" title="If 1, the resulting grids (times) of the first run of each solver are saved to files. If 2, the grids for all runs of each solver are saved.">saveGrid_</a> = s;
<a name="l00068"></a>00068         }
<a name="l00069"></a>00069 
<a name="l00071"></a>00071         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a5db3a4730c85e38aec44c5e20eec545a" title="Sets the environment (grid map) the benchmark will be run on.">setEnvironment</a>
<a name="l00072"></a><a class="code" href="classBenchmark.html#a5db3a4730c85e38aec44c5e20eec545a">00072</a>         (grid_t* grid) {
<a name="l00073"></a>00073             <a class="code" href="classBenchmark.html#a8cc602530ede4f39a13d8dff307123a1" title="Grid the benchmark will be run on.">grid_</a> = grid;
<a name="l00074"></a>00074         }
<a name="l00075"></a>00075 
<a name="l00077"></a>00077         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a9f28f46148d04526f8890c1e09fa3d81" title="Set number of runs for each solver.">setNRuns</a>
<a name="l00078"></a><a class="code" href="classBenchmark.html#a9f28f46148d04526f8890c1e09fa3d81">00078</a>         (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n) {
<a name="l00079"></a>00079             <a class="code" href="classBenchmark.html#a3c1e9fce757032a3d9447d26548a5e64" title="Number of runs for each solver.">nruns_</a> = n;
<a name="l00080"></a>00080         }
<a name="l00081"></a>00081 
<a name="l00083"></a>00083         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a2926d367a34f58e34b75c0344a0f4aee" title="Set the path where results will be saved.">setPath</a>
<a name="l00084"></a><a class="code" href="classBenchmark.html#a2926d367a34f58e34b75c0344a0f4aee">00084</a>         (<span class="keyword">const</span> boost::filesystem::path &amp; path) {
<a name="l00085"></a>00085             <a class="code" href="classBenchmark.html#a059a82a3a32a3d71ac88bc7652f98675" title="Path were the results will be saved.">path_</a> = path;
<a name="l00086"></a>00086         }
<a name="l00087"></a>00087 
<a name="l00089"></a>00089         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a7458d937b2aef80af1a191ca40252b4a" title="Sets the flag to save the log to a file (true) or output in terminal (false).">setSaveLog</a>
<a name="l00090"></a><a class="code" href="classBenchmark.html#a7458d937b2aef80af1a191ca40252b4a">00090</a>         (<span class="keywordtype">bool</span> s) {
<a name="l00091"></a>00091             <a class="code" href="classBenchmark.html#a6cf2de133683c9d1dc066071c112770e" title="If true, the log is saved to file. Output on terminal otherwise.">saveLog_</a> = s;
<a name="l00092"></a>00092         }
<a name="l00093"></a>00093 
<a name="l00095"></a>00095         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a3ee735292a9a3737c5c7bf554ef5684b" title="Sets the initial and goal points (indices) for the solvers.">setInitialAndGoalPoints</a>
<a name="l00096"></a><a class="code" href="classBenchmark.html#a3ee735292a9a3737c5c7bf554ef5684b">00096</a>         (<span class="keyword">const</span> std::vector&lt;unsigned int&gt; &amp; init_points, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> goal_idx) {
<a name="l00097"></a>00097             <a class="code" href="classBenchmark.html#a83697aa1c342034fe0ee1735720cabfa" title="Indices of the initial points.">init_points_</a> = init_points;
<a name="l00098"></a>00098             <a class="code" href="classBenchmark.html#a4d0746bb063200d2f1f303a44dc122a1" title="Index of the goal point.">goal_idx_</a> = goal_idx;
<a name="l00099"></a>00099         }
<a name="l00100"></a>00100 
<a name="l00102"></a><a class="code" href="classBenchmark.html#aa2c1e5f8c5b6ce3c110a8aa929695b32">00102</a>         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#aa2c1e5f8c5b6ce3c110a8aa929695b32" title="Sets the initial points (indices for the solvers).">setInitialPoints</a>(<span class="keyword">const</span> std::vector&lt;unsigned int&gt; &amp; init_points)
<a name="l00103"></a>00103         {
<a name="l00104"></a>00104             <a class="code" href="classBenchmark.html#a3ee735292a9a3737c5c7bf554ef5684b" title="Sets the initial and goal points (indices) for the solvers.">setInitialAndGoalPoints</a>(init_points, -1);
<a name="l00105"></a>00105         }
<a name="l00106"></a>00106 
<a name="l00108"></a>00108         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a1c32fc6aa5dce93f33f5b996824a4455" title="Automatically runs all the solvers.">run</a>
<a name="l00109"></a><a class="code" href="classBenchmark.html#a1c32fc6aa5dce93f33f5b996824a4455">00109</a>         () {
<a name="l00110"></a>00110             <span class="keywordflow">if</span> (<a class="code" href="classBenchmark.html#a4422043c8708bf0b1f64bbd16f8c573f" title="If 1, the resulting grids (times) of the first run of each solver are saved to files. If 2, the grids for all runs of each solver are saved.">saveGrid_</a>)
<a name="l00111"></a>00111             {
<a name="l00112"></a>00112                 boost::filesystem::create_directory(<a class="code" href="classBenchmark.html#a059a82a3a32a3d71ac88bc7652f98675" title="Path were the results will be saved.">path_</a>);
<a name="l00113"></a>00113                 boost::filesystem::create_directory(<a class="code" href="classBenchmark.html#a059a82a3a32a3d71ac88bc7652f98675" title="Path were the results will be saved.">path_</a> / <a class="code" href="classBenchmark.html#aeea93203bda688bab6cb5d0df2c371e3" title="Benchmark name.">name_</a>);
<a name="l00114"></a>00114             }
<a name="l00115"></a>00115             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classBenchmark.html#a6cf2de133683c9d1dc066071c112770e" title="If true, the log is saved to file. Output on terminal otherwise.">saveLog_</a>)
<a name="l00116"></a>00116                 boost::filesystem::create_directory(<a class="code" href="classBenchmark.html#a059a82a3a32a3d71ac88bc7652f98675" title="Path were the results will be saved.">path_</a>);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118             boost::progress_display showProgress (<a class="code" href="classBenchmark.html#a5f28000d7d9e8fc852c0187a93fbaa67" title="Stores the solvers to be run in the benchmark.">solvers_</a>.size()*<a class="code" href="classBenchmark.html#a3c1e9fce757032a3d9447d26548a5e64" title="Number of runs for each solver.">nruns_</a>);
<a name="l00119"></a>00119 
<a name="l00120"></a>00120             <a class="code" href="classBenchmark.html#ac2dd5d3ca54b7553144c56b5238858c3" title="Configures each solver so they are ready to be run.">configSolvers</a>();
<a name="l00121"></a>00121 
<a name="l00122"></a>00122             <a class="code" href="classBenchmark.html#ad1cd93d9cd580c3cdb1e4ef78765084b" title="Logs the benchmark configuration.">logConfig</a>();
<a name="l00123"></a>00123 
<a name="l00124"></a>00124             <span class="keywordflow">for</span> (<a class="code" href="classSolver.html" title="Abstract class that serves as interface for the actual solvers implemented. It requires (at least) th...">Solver&lt;grid_t&gt;</a>* s :<a class="code" href="classBenchmark.html#a5f28000d7d9e8fc852c0187a93fbaa67" title="Stores the solvers to be run in the benchmark.">solvers_</a>)
<a name="l00125"></a>00125             {
<a name="l00126"></a>00126                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classBenchmark.html#a3c1e9fce757032a3d9447d26548a5e64" title="Number of runs for each solver.">nruns_</a>; ++i)
<a name="l00127"></a>00127                 {
<a name="l00128"></a>00128                     ++<a class="code" href="classBenchmark.html#ab1bd24b875944be6239482093f72e57e" title="ID of the current run.">runID_</a>;
<a name="l00129"></a>00129                     s-&gt;reset();
<a name="l00130"></a>00130                     s-&gt;compute();
<a name="l00131"></a>00131                     <a class="code" href="classBenchmark.html#abe280db2e5fa1b2bba0fcf0192015abd" title="Logs the last run of solver s.">logRun</a>(s);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133                     <span class="keywordflow">if</span> (<a class="code" href="classBenchmark.html#a4422043c8708bf0b1f64bbd16f8c573f" title="If 1, the resulting grids (times) of the first run of each solver are saved to files. If 2, the grids for all runs of each solver are saved.">saveGrid_</a> == 2)
<a name="l00134"></a>00134                         <a class="code" href="classBenchmark.html#ab30b8f9f624ab3256ffd7368e7789602" title="Saves the grid values result of the last run of solver s.">saveGrid</a>(s);
<a name="l00135"></a>00135 
<a name="l00136"></a>00136                     ++showProgress;
<a name="l00137"></a>00137                 }
<a name="l00138"></a>00138                 <span class="keywordflow">if</span> (<a class="code" href="classBenchmark.html#a4422043c8708bf0b1f64bbd16f8c573f" title="If 1, the resulting grids (times) of the first run of each solver are saved to files. If 2, the grids for all runs of each solver are saved.">saveGrid_</a> == 1)
<a name="l00139"></a>00139                     <a class="code" href="classBenchmark.html#ab30b8f9f624ab3256ffd7368e7789602" title="Saves the grid values result of the last run of solver s.">saveGrid</a>(s);
<a name="l00140"></a>00140                 s-&gt;reset();                
<a name="l00141"></a>00141             }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143             <span class="keywordflow">if</span> (<a class="code" href="classBenchmark.html#a6cf2de133683c9d1dc066071c112770e" title="If true, the log is saved to file. Output on terminal otherwise.">saveLog_</a>)
<a name="l00144"></a>00144                 <a class="code" href="classBenchmark.html#a9abd5007cab840911646b3d684e7f9ae" title="Saves the log to a file: benchmark_name.log.">saveLog</a>();
<a name="l00145"></a>00145             <span class="keywordflow">else</span> {
<a name="l00146"></a>00146                 <a class="code" href="classconsole.html#a17f39c0f31aa6e5ae3d3b3ae2f39e747">console::info</a>(<span class="stringliteral">&quot;Benchmark log format:&quot;</span>);
<a name="l00147"></a>00147                 std::cout &lt;&lt; <span class="stringliteral">&quot;Name\t#Runs\t#Dims\tDim1...DimN\t#Starts\tStartIdx\tGoalIdx&quot;</span>&lt;&lt;<span class="charliteral">&#39;\n&#39;</span>;
<a name="l00148"></a>00148                 std::cout &lt;&lt; <span class="stringliteral">&quot;RunID\tName\tTime (ms)&quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00149"></a>00149                 std::cout &lt;&lt; <a class="code" href="classBenchmark.html#a765b2d9f467a2b40336e8d0a4502a6b6" title="Log stream.">log_</a>.str() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00150"></a>00150             }
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152 
<a name="l00154"></a>00154         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#abe280db2e5fa1b2bba0fcf0192015abd" title="Logs the last run of solver s.">logRun</a>
<a name="l00155"></a><a class="code" href="classBenchmark.html#abe280db2e5fa1b2bba0fcf0192015abd">00155</a>         (<span class="keyword">const</span> <a class="code" href="classSolver.html" title="Abstract class that serves as interface for the actual solvers implemented. It requires (at least) th...">Solver&lt;grid_t&gt;</a>* s)
<a name="l00156"></a>00156         {
<a name="l00157"></a>00157             std::ios init(NULL);
<a name="l00158"></a>00158             init.copyfmt(std::cout);
<a name="l00159"></a>00159             <a class="code" href="classBenchmark.html#a1b385fc3a44d5aff4a2035fcecb1507e" title="Formats as a string the run ID.">formatID</a>();
<a name="l00160"></a>00160             <a class="code" href="classBenchmark.html#a765b2d9f467a2b40336e8d0a4502a6b6" title="Log stream.">log_</a> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; <a class="code" href="classBenchmark.html#a17d1625d3ab46fc1813d643634927417" title="Formatted run ID:">fmtID_</a>;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162             std::cout.copyfmt(init);
<a name="l00163"></a>00163             <a class="code" href="classBenchmark.html#a765b2d9f467a2b40336e8d0a4502a6b6" title="Log stream.">log_</a> &lt;&lt; <span class="charliteral">&#39;\t&#39;</span> &lt;&lt; s-&gt;<a class="code" href="classSolver.html#a720c179ac61c335739de5ceeab06864e" title="Returns name of the solver.">getName</a>() &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; s-&gt;getTime();
<a name="l00164"></a>00164         }
<a name="l00165"></a>00165 
<a name="l00167"></a>00167         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#ab30b8f9f624ab3256ffd7368e7789602" title="Saves the grid values result of the last run of solver s.">saveGrid</a>
<a name="l00168"></a><a class="code" href="classBenchmark.html#ab30b8f9f624ab3256ffd7368e7789602">00168</a>         (<a class="code" href="classSolver.html" title="Abstract class that serves as interface for the actual solvers implemented. It requires (at least) th...">Solver&lt;grid_t&gt;</a>* s) <span class="keyword">const</span> {
<a name="l00169"></a>00169             thread_local boost::filesystem::path filename;
<a name="l00170"></a>00170             <span class="keywordflow">if</span> (<a class="code" href="classBenchmark.html#a4422043c8708bf0b1f64bbd16f8c573f" title="If 1, the resulting grids (times) of the first run of each solver are saved to files. If 2, the grids for all runs of each solver are saved.">saveGrid_</a> == 1)
<a name="l00171"></a>00171                 filename = <a class="code" href="classBenchmark.html#a059a82a3a32a3d71ac88bc7652f98675" title="Path were the results will be saved.">path_</a> / <a class="code" href="classBenchmark.html#aeea93203bda688bab6cb5d0df2c371e3" title="Benchmark name.">name_</a> / s-&gt;<a class="code" href="classSolver.html#a720c179ac61c335739de5ceeab06864e" title="Returns name of the solver.">getName</a>();
<a name="l00172"></a>00172             <span class="keywordflow">if</span> (<a class="code" href="classBenchmark.html#a4422043c8708bf0b1f64bbd16f8c573f" title="If 1, the resulting grids (times) of the first run of each solver are saved to files. If 2, the grids for all runs of each solver are saved.">saveGrid_</a> == 2)
<a name="l00173"></a>00173                 filename = <a class="code" href="classBenchmark.html#a059a82a3a32a3d71ac88bc7652f98675" title="Path were the results will be saved.">path_</a> / <a class="code" href="classBenchmark.html#aeea93203bda688bab6cb5d0df2c371e3" title="Benchmark name.">name_</a> / <a class="code" href="classBenchmark.html#a17d1625d3ab46fc1813d643634927417" title="Formatted run ID:">fmtID_</a>;
<a name="l00174"></a>00174             
<a name="l00175"></a>00175             filename.replace_extension(<span class="stringliteral">&quot;.grid&quot;</span>);
<a name="l00176"></a>00176             <a class="code" href="classGridWriter.html#ae1ba79d772064bfc03a24b58aee73602" title="Saves grid values in ASCII format into the specified file.">GridWriter::saveGridValues</a>(filename.string().c_str(), *(s-&gt;<a class="code" href="classSolver.html#ae9a8112571d970d975c896e7367d5f83" title="Returns a pointer to the grid used.">getGrid</a>()));
<a name="l00177"></a>00177         }
<a name="l00178"></a>00178 
<a name="l00180"></a>00180         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a9abd5007cab840911646b3d684e7f9ae" title="Saves the log to a file: benchmark_name.log.">saveLog</a>
<a name="l00181"></a><a class="code" href="classBenchmark.html#a9abd5007cab840911646b3d684e7f9ae">00181</a>         () <span class="keyword">const</span> {
<a name="l00182"></a>00182             std::ofstream ofs (<a class="code" href="classBenchmark.html#a059a82a3a32a3d71ac88bc7652f98675" title="Path were the results will be saved.">path_</a>.string() + <span class="stringliteral">&quot;/&quot;</span> + <a class="code" href="classBenchmark.html#aeea93203bda688bab6cb5d0df2c371e3" title="Benchmark name.">name_</a> + <span class="stringliteral">&quot;.log&quot;</span>);
<a name="l00183"></a>00183             ofs &lt;&lt; <a class="code" href="classBenchmark.html#a765b2d9f467a2b40336e8d0a4502a6b6" title="Log stream.">log_</a>.rdbuf();
<a name="l00184"></a>00184             ofs.close();
<a name="l00185"></a>00185         }
<a name="l00186"></a>00186 
<a name="l00188"></a>00188         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a102650550987c23aed530a1134f66bd1" title="Sets the name of the benchmark.">setName</a>
<a name="l00189"></a><a class="code" href="classBenchmark.html#a102650550987c23aed530a1134f66bd1">00189</a>         (<span class="keyword">const</span> std::string &amp; n)
<a name="l00190"></a>00190         {
<a name="l00191"></a>00191             <a class="code" href="classBenchmark.html#aeea93203bda688bab6cb5d0df2c371e3" title="Benchmark name.">name_</a> = n;
<a name="l00192"></a>00192         }
<a name="l00193"></a>00193 
<a name="l00195"></a>00195         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a1e3415434c820dee4fde0b0fee1b7ec3" title="Clears and free memory allocated by the benchmark.">clear</a>
<a name="l00196"></a><a class="code" href="classBenchmark.html#a1e3415434c820dee4fde0b0fee1b7ec3">00196</a>         () {
<a name="l00197"></a>00197             <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp; s : <a class="code" href="classBenchmark.html#a5f28000d7d9e8fc852c0187a93fbaa67" title="Stores the solvers to be run in the benchmark.">solvers_</a>)
<a name="l00198"></a>00198                 <span class="keyword">delete</span> s;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200             solvers_.<a class="code" href="classSolver.html#a0ccf346cac7b8518adeae874ebf0b2dd" title="Clears the solver, it is not recommended to be used out of the destructor.">clear</a>();
<a name="l00201"></a>00201 
<a name="l00202"></a>00202             <span class="keywordflow">if</span>(<a class="code" href="classBenchmark.html#a4f0af32d7e8e95e760b5de4f26854d65" title="If true, benchmark configured from CFG file, used to selectively free memory.">fromCFG_</a>)
<a name="l00203"></a>00203                 <span class="keyword">delete</span> <a class="code" href="classBenchmark.html#a8cc602530ede4f39a13d8dff307123a1" title="Grid the benchmark will be run on.">grid_</a>;
<a name="l00204"></a>00204         }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <span class="keyword">private</span>:
<a name="l00208"></a>00208         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#ad1cd93d9cd580c3cdb1e4ef78765084b" title="Logs the benchmark configuration.">logConfig</a>
<a name="l00209"></a><a class="code" href="classBenchmark.html#ad1cd93d9cd580c3cdb1e4ef78765084b">00209</a>         () {
<a name="l00210"></a>00210             <a class="code" href="classBenchmark.html#a765b2d9f467a2b40336e8d0a4502a6b6" title="Log stream.">log_</a> &lt;&lt; <a class="code" href="classBenchmark.html#aeea93203bda688bab6cb5d0df2c371e3" title="Benchmark name.">name_</a> &lt;&lt; <span class="charliteral">&#39;\t&#39;</span> &lt;&lt; <a class="code" href="classBenchmark.html#a3c1e9fce757032a3d9447d26548a5e64" title="Number of runs for each solver.">nruns_</a> &lt;&lt; <span class="charliteral">&#39;\t&#39;</span> &lt;&lt; <a class="code" href="classBenchmark.html#a8cc602530ede4f39a13d8dff307123a1" title="Grid the benchmark will be run on.">grid_</a>-&gt;getNDims()
<a name="l00211"></a>00211                  &lt;&lt; <span class="charliteral">&#39;\t&#39;</span> &lt;&lt; <a class="code" href="classBenchmark.html#a8cc602530ede4f39a13d8dff307123a1" title="Grid the benchmark will be run on.">grid_</a>-&gt;getDimSizesStr();
<a name="l00212"></a>00212 
<a name="l00213"></a>00213             <span class="comment">// Saving starting points.</span>
<a name="l00214"></a>00214             <a class="code" href="classBenchmark.html#a765b2d9f467a2b40336e8d0a4502a6b6" title="Log stream.">log_</a> &lt;&lt; <a class="code" href="classBenchmark.html#a83697aa1c342034fe0ee1735720cabfa" title="Indices of the initial points.">init_points_</a>.size() &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>;
<a name="l00215"></a>00215             std::copy(<a class="code" href="classBenchmark.html#a83697aa1c342034fe0ee1735720cabfa" title="Indices of the initial points.">init_points_</a>.begin(), <a class="code" href="classBenchmark.html#a83697aa1c342034fe0ee1735720cabfa" title="Indices of the initial points.">init_points_</a>.end(), std::ostream_iterator&lt;unsigned int&gt;(<a class="code" href="classBenchmark.html#a765b2d9f467a2b40336e8d0a4502a6b6" title="Log stream.">log_</a>, <span class="stringliteral">&quot;\t&quot;</span>));
<a name="l00216"></a>00216 
<a name="l00217"></a>00217             <span class="keywordflow">if</span> (<span class="keywordtype">int</span>(<a class="code" href="classBenchmark.html#a4d0746bb063200d2f1f303a44dc122a1" title="Index of the goal point.">goal_idx_</a>) == -1)
<a name="l00218"></a>00218                 log_ &lt;&lt; <span class="stringliteral">&quot;nan&quot;</span>;
<a name="l00219"></a>00219             <span class="keywordflow">else</span>
<a name="l00220"></a>00220                 log_ &lt;&lt; <a class="code" href="classBenchmark.html#a4d0746bb063200d2f1f303a44dc122a1" title="Index of the goal point.">goal_idx_</a>;
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222 
<a name="l00224"></a>00224         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#ac2dd5d3ca54b7553144c56b5238858c3" title="Configures each solver so they are ready to be run.">configSolvers</a>
<a name="l00225"></a><a class="code" href="classBenchmark.html#ac2dd5d3ca54b7553144c56b5238858c3">00225</a>         () {
<a name="l00226"></a>00226             <span class="keywordflow">for</span> (<a class="code" href="classSolver.html" title="Abstract class that serves as interface for the actual solvers implemented. It requires (at least) th...">Solver&lt;grid_t&gt;</a>* s :<a class="code" href="classBenchmark.html#a5f28000d7d9e8fc852c0187a93fbaa67" title="Stores the solvers to be run in the benchmark.">solvers_</a>)
<a name="l00227"></a>00227             {
<a name="l00228"></a>00228                 s-&gt;<a class="code" href="classSolver.html#a7ccc2ab5b4b924c90e385134172cccac" title="Sets and cleans the grid in which operations will be performed.">setEnvironment</a>(<a class="code" href="classBenchmark.html#a8cc602530ede4f39a13d8dff307123a1" title="Grid the benchmark will be run on.">grid_</a>);
<a name="l00229"></a>00229                 s-&gt;<a class="code" href="classSolver.html#a6ba68689231a50f9413e08a5bc3d7e86" title="Sets the initial and goal points by the indices of the grid.">setInitialAndGoalPoints</a>(<a class="code" href="classBenchmark.html#a83697aa1c342034fe0ee1735720cabfa" title="Indices of the initial points.">init_points_</a>, <a class="code" href="classBenchmark.html#a4d0746bb063200d2f1f303a44dc122a1" title="Index of the goal point.">goal_idx_</a>);
<a name="l00230"></a>00230             }
<a name="l00231"></a>00231         }
<a name="l00232"></a>00232 
<a name="l00234"></a>00234         <span class="keywordtype">void</span> <a class="code" href="classBenchmark.html#a1b385fc3a44d5aff4a2035fcecb1507e" title="Formats as a string the run ID.">formatID</a>
<a name="l00235"></a><a class="code" href="classBenchmark.html#a1b385fc3a44d5aff4a2035fcecb1507e">00235</a>         () {
<a name="l00236"></a>00236             thread_local std::ostringstream oss; <span class="comment">// To optimize a bit.</span>
<a name="l00237"></a>00237             oss.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00238"></a>00238             oss.clear();
<a name="l00239"></a>00239             oss &lt;&lt; std::setw(4) &lt;&lt; std::setfill(<span class="charliteral">&#39;0&#39;</span>) &lt;&lt; <a class="code" href="classBenchmark.html#ab1bd24b875944be6239482093f72e57e" title="ID of the current run.">runID_</a>;
<a name="l00240"></a>00240             <a class="code" href="classBenchmark.html#a17d1625d3ab46fc1813d643634927417" title="Formatted run ID:">fmtID_</a> = oss.str();
<a name="l00241"></a>00241         }
<a name="l00242"></a>00242 
<a name="l00244"></a><a class="code" href="classBenchmark.html#a5f28000d7d9e8fc852c0187a93fbaa67">00244</a>         std::vector&lt;Solver&lt;grid_t&gt;*&gt;                        <a class="code" href="classBenchmark.html#a5f28000d7d9e8fc852c0187a93fbaa67" title="Stores the solvers to be run in the benchmark.">solvers_</a>;
<a name="l00245"></a>00245         
<a name="l00247"></a><a class="code" href="classBenchmark.html#a8cc602530ede4f39a13d8dff307123a1">00247</a>         grid_t *                                            <a class="code" href="classBenchmark.html#a8cc602530ede4f39a13d8dff307123a1" title="Grid the benchmark will be run on.">grid_</a>;
<a name="l00248"></a>00248 
<a name="l00250"></a><a class="code" href="classBenchmark.html#a83697aa1c342034fe0ee1735720cabfa">00250</a>         std::vector&lt;unsigned int&gt;                           <a class="code" href="classBenchmark.html#a83697aa1c342034fe0ee1735720cabfa" title="Indices of the initial points.">init_points_</a>;
<a name="l00251"></a>00251         
<a name="l00253"></a><a class="code" href="classBenchmark.html#a4d0746bb063200d2f1f303a44dc122a1">00253</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                                        <a class="code" href="classBenchmark.html#a4d0746bb063200d2f1f303a44dc122a1" title="Index of the goal point.">goal_idx_</a>;
<a name="l00254"></a>00254 
<a name="l00256"></a><a class="code" href="classBenchmark.html#acf601768f3886ef4152c7b498c99a61a">00256</a>         std::chrono::time_point&lt;std::chrono::system_clock&gt;  <a class="code" href="classBenchmark.html#acf601768f3886ef4152c7b498c99a61a" title="Time measurement variables.">start_</a>, end_;
<a name="l00257"></a>00257 
<a name="l00259"></a><a class="code" href="classBenchmark.html#a765b2d9f467a2b40336e8d0a4502a6b6">00259</a>         std::stringstream                                   <a class="code" href="classBenchmark.html#a765b2d9f467a2b40336e8d0a4502a6b6" title="Log stream.">log_</a>;
<a name="l00260"></a>00260 
<a name="l00263"></a><a class="code" href="classBenchmark.html#a4422043c8708bf0b1f64bbd16f8c573f">00263</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                                        <a class="code" href="classBenchmark.html#a4422043c8708bf0b1f64bbd16f8c573f" title="If 1, the resulting grids (times) of the first run of each solver are saved to files. If 2, the grids for all runs of each solver are saved.">saveGrid_</a>;
<a name="l00264"></a>00264         
<a name="l00266"></a><a class="code" href="classBenchmark.html#a6cf2de133683c9d1dc066071c112770e">00266</a>         <span class="keywordtype">bool</span>                                                <a class="code" href="classBenchmark.html#a6cf2de133683c9d1dc066071c112770e" title="If true, the log is saved to file. Output on terminal otherwise.">saveLog_</a>;
<a name="l00267"></a>00267 
<a name="l00269"></a><a class="code" href="classBenchmark.html#ab1bd24b875944be6239482093f72e57e">00269</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                                        <a class="code" href="classBenchmark.html#ab1bd24b875944be6239482093f72e57e" title="ID of the current run.">runID_</a>;
<a name="l00270"></a>00270         
<a name="l00272"></a><a class="code" href="classBenchmark.html#a17d1625d3ab46fc1813d643634927417">00272</a>         std::string                                         <a class="code" href="classBenchmark.html#a17d1625d3ab46fc1813d643634927417" title="Formatted run ID:">fmtID_</a>;
<a name="l00273"></a>00273         
<a name="l00275"></a><a class="code" href="classBenchmark.html#a3c1e9fce757032a3d9447d26548a5e64">00275</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                                        <a class="code" href="classBenchmark.html#a3c1e9fce757032a3d9447d26548a5e64" title="Number of runs for each solver.">nruns_</a>;
<a name="l00276"></a>00276 
<a name="l00278"></a><a class="code" href="classBenchmark.html#a059a82a3a32a3d71ac88bc7652f98675">00278</a>         boost::filesystem::path                             <a class="code" href="classBenchmark.html#a059a82a3a32a3d71ac88bc7652f98675" title="Path were the results will be saved.">path_</a>;
<a name="l00279"></a>00279         
<a name="l00281"></a><a class="code" href="classBenchmark.html#aeea93203bda688bab6cb5d0df2c371e3">00281</a>         std::string                                         <a class="code" href="classBenchmark.html#aeea93203bda688bab6cb5d0df2c371e3" title="Benchmark name.">name_</a>;
<a name="l00282"></a>00282 
<a name="l00284"></a><a class="code" href="classBenchmark.html#a4f0af32d7e8e95e760b5de4f26854d65">00284</a>         <span class="keywordtype">bool</span>                                                <a class="code" href="classBenchmark.html#a4f0af32d7e8e95e760b5de4f26854d65" title="If true, benchmark configured from CFG file, used to selectively free memory.">fromCFG_</a>;
<a name="l00285"></a>00285 };
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="preprocessor">#endif </span><span class="comment">/* BENCHMARK_HPP_*/</span>
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>benchmark.hpp</b>      </li>

    <li class="footer">Generated on Thu May 14 2015 18:58:30 for n-Dimensional Fast Marching by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
